<app-base-list [title]="'Vendas'" [searchPlaceholder]="'Buscar venda'" [emptyMessage]="'Nenhuma venda encontrada.'"
  [columns]="columns" [data]="vendas" [isLoading]="isLoading" (onNew)="openDialog()" (onEdit)="openDialog($event)"
  (onDelete)="excluir($event)">
</app-base-list>

<!-- Template para a tab de Itens no modal -->
<ng-template #itensTemplate let-data>
  <div class="itens-tab-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Itens da Venda</h4>
      <button mat-raised-button class="btn-new-item" (click)="onNewItem()">
        <mat-icon>add</mat-icon> Novo Item
      </button>
    </div>

    <div *ngIf="itens.length === 0" class="empty-message">
      <p>Nenhum item adicionado. Clique em "Novo Item" para adicionar.</p>
    </div>

    <table mat-table [dataSource]="itens" class="w-100" *ngIf="itens.length > 0">
      <ng-container matColumnDef="produtoSku">
        <th mat-header-cell *matHeaderCellDef>Produto / SKU</th>
        <td mat-cell *matCellDef="let item">
          {{ getSkuDescricao(item.produtoSkuId) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="quantidade">
        <th mat-header-cell *matHeaderCellDef>Quantidade</th>
        <td mat-cell *matCellDef="let item">
          {{ item.quantidade }}
        </td>
      </ng-container>

      <ng-container matColumnDef="precoUnitario">
        <th mat-header-cell *matHeaderCellDef>Preço Unitário</th>
        <td mat-cell *matCellDef="let item">
          {{ getSkuPreco(item.produtoSkuId) | currency:'BRL' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef>Subtotal</th>
        <td mat-cell *matCellDef="let item">
          {{ (getSkuPreco(item.produtoSkuId) * item.quantidade) | currency:'BRL' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let item; let i = index">
          <button mat-icon-button class="btn-delete-item" (click)="onDeleteItem(i)" matTooltip="Remover item">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['produtoSku', 'quantidade', 'precoUnitario', 'subtotal', 'acoes']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['produtoSku', 'quantidade', 'precoUnitario', 'subtotal', 'acoes'];">
      </tr>
    </table>
  </div>
</ng-template>
