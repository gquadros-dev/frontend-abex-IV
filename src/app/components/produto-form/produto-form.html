<app-base-list [title]="'Produtos'" [searchPlaceholder]="'Buscar produto'" [emptyMessage]="'Nenhum produto encontrado.'"
  [columns]="columns" [data]="produtos" [isLoading]="isLoading" (onNew)="openDialog()" (onEdit)="openDialog($event)"
  (onDelete)="excluir($event)">
</app-base-list>

<!-- Template para a tab de SKUs no modal -->
<ng-template #skusTemplate let-data>
  <div class="skus-tab-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>SKUs do Produto</h4>
      <button mat-raised-button class="btn-new-sku" (click)="onNewSku()" [disabled]="!produtoIdNoModal">
        <mat-icon>add</mat-icon> Novo SKU
      </button>
    </div>

    <div *ngIf="skus.length === 0" class="empty-message">
      <p *ngIf="!produtoIdNoModal">Salve o produto primeiro para adicionar SKUs.</p>
      <p *ngIf="produtoIdNoModal">Nenhum SKU cadastrado. Clique em "Novo SKU" para adicionar.</p>
    </div>

    <mat-accordion *ngIf="skus.length > 0" class="w-100">
      <mat-expansion-panel *ngFor="let sku of skus" class="mb-2">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <div class="d-flex justify-content-between align-items-center w-100">
              <span><strong>{{ sku.descricao }}</strong></span>
              <span class="ms-3 text-muted">
                {{ getVariationName(sku.produtoVariationId1) }}
                <span *ngIf="sku.produtoVariationId2"> / {{ getVariationName(sku.produtoVariationId2) }}</span>
              </span>
              <span class="ms-3">{{ sku.precoVenda | currency:'BRL' }}</span>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="sku-details p-3">
          <div class="row mb-3">
            <div class="col-md-6">
              <p><strong>Descrição:</strong> {{ sku.descricao }}</p>
              <p><strong>Variação 1:</strong> {{ getVariationName(sku.produtoVariationId1) }}</p>
              <p *ngIf="sku.produtoVariationId2"><strong>Variação 2:</strong> {{
                getVariationName(sku.produtoVariationId2) }}</p>
              <p><strong>Preço de Venda:</strong> {{ sku.precoVenda | currency:'BRL' }}</p>
            </div>
            <div class="col-md-6">
              <h5>Estoque</h5>
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Quantidade Atual</mat-label>
                <input matInput type="number" [ngModel]="getEstoque(sku.id)?.quantidadeAtual || 0"
                  #estoqueInput="ngModel" min="0" (blur)="atualizarEstoque(sku.id, estoqueInput.value)"
                  (keyup.enter)="atualizarEstoque(sku.id, estoqueInput.value)" />
              </mat-form-field>
              <p class="text-muted small">
                <span *ngIf="getEstoque(sku.id)">
                  Última atualização: {{ getEstoque(sku.id)?.atualizadoEm | date:'dd/MM/yyyy HH:mm' }}
                </span>
                <span *ngIf="!getEstoque(sku.id)">
                  Estoque ainda não cadastrado. Digite uma quantidade e pressione Enter ou clique fora do campo.
                </span>
              </p>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button mat-raised-button class="btn-edit-sku" (click)="onEditSku(sku)">
              <mat-icon>edit</mat-icon> Editar SKU
            </button>
            <button mat-raised-button class="btn-delete-sku" (click)="onDeleteSku(sku)">
              <mat-icon>delete</mat-icon> Excluir SKU
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</ng-template>
